{"version":3,"file":"forms.js.map","sources":["ng://@ng-bucket/forms/internal/form-observer/property-changes.ts","ng://@ng-bucket/forms/internal/form-observer/form-observer.ts"],"sourcesContent":["import { Observable, Subject } from 'rxjs';\r\n\r\nexport function propertyChanges<T extends object, K extends keyof T>(obj: T, prop: K): Observable<T[K]> {\r\n  const propertyObserver = getPropertyObserver(obj);\r\n\r\n  if (!propertyObserver[prop]) {\r\n    const subject = new Subject<T[K]>();\r\n    onChange(obj, prop, newValue => subject.next(newValue));\r\n    propertyObserver[prop] = subject.asObservable();\r\n  }\r\n\r\n  return propertyObserver[prop];\r\n}\r\n\r\nfunction getPropertyObserver<T extends object>(obj: T): { [K in keyof T]?: Observable<T[K]> } {\r\n  const PROPERTY_OBSERVER_KEY = 'ng-bucket';\r\n\r\n  if (!obj[PROPERTY_OBSERVER_KEY]) {\r\n    Object.defineProperty(obj, PROPERTY_OBSERVER_KEY, {enumerable: false, value: {}});\r\n  }\r\n\r\n  return obj[PROPERTY_OBSERVER_KEY];\r\n}\r\n\r\nfunction onChange<T extends object, K extends keyof T>(obj: T, prop: K, callback: (value: T[K]) => void) {\r\n  const descriptor = createDescriptor(obj, prop);\r\n  const setter = descriptor.set;\r\n  descriptor.set = function() {\r\n    setter.apply(setter, arguments);\r\n    callback(arguments[0]);\r\n  };\r\n\r\n  Object.defineProperty(obj, prop, descriptor);\r\n}\r\n\r\nfunction createDescriptor<T extends object, K extends keyof T>(obj: T, prop: K): PropertyDescriptor {\r\n  let descriptor = Object.getOwnPropertyDescriptor(obj, prop);\r\n\r\n  if (descriptor.hasOwnProperty('value') && descriptor.writable) {\r\n    let value = descriptor.value;\r\n    descriptor = {...descriptor};\r\n\r\n    descriptor.set = v => value = v;\r\n    descriptor.get = () => value;\r\n\r\n    delete descriptor.value;\r\n    delete descriptor.writable;\r\n  }\r\n\r\n  return descriptor;\r\n}\r\n","import { AbstractControl } from '@angular/forms';\r\nimport { merge, Observable } from 'rxjs';\r\nimport { distinctUntilChanged, map, skipWhile } from 'rxjs/operators';\r\nimport { FormObserverStateEvent } from './form-observer-state-event';\r\nimport { propertyChanges } from './property-changes';\r\n\r\nexport function pristineChanges$(control: AbstractControl): Observable<boolean> {\r\n  return propertyChanges(control, 'pristine').pipe(\r\n    map(() => control.pristine),\r\n    skipWhile(initialValue(control.pristine)),\r\n    distinctUntilChanged(),\r\n  );\r\n}\r\n\r\nexport function dirtyChanges$(control: AbstractControl): Observable<boolean> {\r\n  return pristineChanges$(control).pipe(map(pristine => !pristine));\r\n}\r\n\r\nexport function touchedChanges$(control: AbstractControl): Observable<boolean> {\r\n  return propertyChanges(control, 'touched').pipe(\r\n    map(() => control.touched),\r\n    skipWhile(initialValue(control.touched)),\r\n    distinctUntilChanged(),\r\n  );\r\n}\r\n\r\nexport function untouchedChanges$(control: AbstractControl): Observable<boolean> {\r\n  return touchedChanges$(control).pipe(map(touched => !touched));\r\n}\r\n\r\nexport function statusChanges$(control: AbstractControl): Observable<string> {\r\n  return propertyChanges(control, 'status').pipe(\r\n    map(() => control.status),\r\n    skipWhile(initialValue(control.status)),\r\n    distinctUntilChanged(),\r\n  );\r\n}\r\n\r\nexport function enabledChanges$(control: AbstractControl): Observable<boolean> {\r\n  return statusChanges$(control).pipe(\r\n    map(() => control.enabled),\r\n    skipWhile(initialValue(control.enabled)),\r\n    distinctUntilChanged(),\r\n  );\r\n}\r\n\r\nexport function disabledChanges$(control: AbstractControl): Observable<boolean> {\r\n  return enabledChanges$(control).pipe(map(enabled => !enabled));\r\n}\r\n\r\nexport function pendingChanges$(control: AbstractControl): Observable<boolean> {\r\n  return statusChanges$(control).pipe(\r\n    map(() => control.pending),\r\n    skipWhile(initialValue(control.pending)),\r\n    distinctUntilChanged(),\r\n  );\r\n}\r\n\r\nexport function validChanges$(control: AbstractControl): Observable<boolean> {\r\n  return statusChanges$(control).pipe(\r\n    map(() => control.valid),\r\n    skipWhile(initialValue(control.valid)),\r\n    distinctUntilChanged(),\r\n  );\r\n}\r\n\r\nexport function invalidChanges$(control: AbstractControl): Observable<boolean> {\r\n  return statusChanges$(control).pipe(\r\n    map(() => control.invalid),\r\n    skipWhile(initialValue(control.invalid)),\r\n    distinctUntilChanged(),\r\n  );\r\n}\r\n\r\nexport function valueChanges$(control: AbstractControl): Observable<any> {\r\n  return propertyChanges(control, 'value').pipe(\r\n    map(() => control.value),\r\n    skipWhile(initialValue(control.value)),\r\n    distinctUntilChanged(),\r\n  );\r\n}\r\n\r\nexport function stateChanges$(control: AbstractControl): Observable<FormObserverStateEvent> {\r\n  return merge(\r\n    pristineChanges$(control),\r\n    touchedChanges$(control),\r\n    statusChanges$(control),\r\n    valueChanges$(control),\r\n  ).pipe(map(() => ({\r\n    pristine: control.pristine,\r\n    dirty: control.dirty,\r\n    touched: control.touched,\r\n    untouched: control.untouched,\r\n    status: control.status,\r\n    enabled: control.enabled,\r\n    disabled: control.disabled,\r\n    pending: control.pending,\r\n    valid: control.valid,\r\n    invalid: control.invalid,\r\n    value: control.value,\r\n  })));\r\n}\r\n\r\n\r\n// tslint:disable-next-line:no-shadowed-variable\r\nfunction initialValue<T>(initialValue: T): (v: T) => boolean {\r\n  return value => value === initialValue;\r\n}\r\n"],"names":[],"mappings":"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"}
